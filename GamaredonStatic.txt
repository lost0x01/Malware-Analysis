Gamaredon Static Analysis

Sample Name: 002e1b63a76a7125772cbf2ffd69e80d4d6491d72376ff04dafeb8c3cdc43831
File ReName: Gamaredon
File Type: 32-bit executable
Language: Russian
md5: 2b780bbbbbdb7d4f487d6f2194bbad29                                                   |
sha1: fb01ff276c88ed42112256d2106495e79f9f1145                                           |
sha256: 002e1b63a76a7125772cbf2ffd69e80d4d6491d72376ff04dafeb8c3cdc43831  

Summary: Ransomware suite with Keylogger and Mouse Capture features, and the ability to encrypt data. 


Capa Output:
+------------------------+------------------------------------------------------------------------------------+
| ATT&CK Tactic          | ATT&CK Technique                                                                   |
|------------------------+------------------------------------------------------------------------------------|
| COLLECTION             | Input Capture::Keylogging [T1056.001]                                              |
| DEFENSE EVASION        | File and Directory Permissions Modification [T1222]                                |
|                        | Obfuscated Files or Information [T1027]                                            |
| DISCOVERY              | File and Directory Discovery [T1083]                                               |
|                        | System Information Discovery [T1082]                                               |
|                        | System Location Discovery [T1614]                                                  |
|                        | System Owner/User Discovery [T1033]                                                |
| EXECUTION              | Command and Scripting Interpreter [T1059]                                          |
|                        | Shared Modules [T1129]                                                             |
+------------------------+------------------------------------------------------------------------------------+

+-----------------------------+-------------------------------------------------------------------------------+
| MBC Objective               | MBC Behavior                                                                  |
|-----------------------------+-------------------------------------------------------------------------------|
| COLLECTION                  | Keylogging::Application Hook [F0002.001]                                      |
|                             | Keylogging::Polling [F0002.002]                                               |
| CRYPTOGRAPHY                | Encrypt Data::RC4 [C0027.009]                                                 |
|                             | Encryption Key::RC4 KSA [C0028.002]                                           |
| DATA                        | Checksum::CRC32 [C0032.001]                                                   |
|                             | Encode Data::XOR [C0026.002]                                                  |
| DEFENSE EVASION             | Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]      |
| FILE SYSTEM                 | Create Directory [C0046]                                                      |
|                             | Delete Directory [C0048]                                                      |
|                             | Delete File [C0047]                                                           |
|                             | Get File Attributes [C0049]                                                   |
|                             | Read File [C0051]                                                             |
|                             | Set File Attributes [C0050]                                                   |
|                             | Writes File [C0052]                                                           |
| OPERATING SYSTEM            | Environment Variable::Set Variable [C0034.001]                                |
| PROCESS                     | Create Process [C0017]                                                        |
|                             | Create Thread [C0038]                                                         |
|                             | Resume Thread [C0054]                                                         |
|                             | Terminate Process [C0018]                                                     |
+-----------------------------+-------------------------------------------------------------------------------+

+------------------------------------------------------+------------------------------------------------------+
| CAPABILITY                                           | NAMESPACE                                            |
|------------------------------------------------------+------------------------------------------------------|
| inspect load icon resource                           | anti-analysis                                        |
| get geographical location                            | collection                                           |
| log keystrokes via application hook                  | collection/keylog                                    |
| log keystrokes via polling                           | collection/keylog                                    |
| hash data with CRC32                                 | data-manipulation/checksum/crc32                     |
| encode data using XOR (4 matches)                    | data-manipulation/encoding/xor                       |
| encrypt data using RC4 KSA                           | data-manipulation/encryption/rc4                     |
| contain a resource (.rsrc) section                   | executable/pe/section/rsrc                           |
| extract resource via kernel32 functions              | executable/resource                                  |
| accept command line arguments (2 matches)            | host-interaction/cli                                 |
| query environment variable (3 matches)               | host-interaction/environment-variable                |
| set environment variable                             | host-interaction/environment-variable                |
| get common file path (4 matches)                     | host-interaction/file-system                         |
| get file system object information                   | host-interaction/file-system                         |
| create directory                                     | host-interaction/file-system/create                  |
| delete directory                                     | host-interaction/file-system/delete                  |
| delete file (2 matches)                              | host-interaction/file-system/delete                  |
| check if file exists (3 matches)                     | host-interaction/file-system/exists                  |
| enumerate files recursively                          | host-interaction/file-system/files/list              |
| get file attributes (4 matches)                      | host-interaction/file-system/meta                    |
| get file size                                        | host-interaction/file-system/meta                    |
| set file attributes (4 matches)                      | host-interaction/file-system/meta                    |
| read file (2 matches)                                | host-interaction/file-system/read                    |
| create shortcut via IShellLink                       | host-interaction/file-system/write                   |
| write file (3 matches)                               | host-interaction/file-system/write                   |
| get disk information                                 | host-interaction/hardware/storage                    |
| get disk size                                        | host-interaction/hardware/storage                    |
| check OS version                                     | host-interaction/os/version                          |
| create process (3 matches)                           | host-interaction/process/create                      |
| terminate process                                    | host-interaction/process/terminate                   |
| get token membership                                 | host-interaction/session                             |
| create thread (2 matches)                            | host-interaction/thread/create                       |
| resume thread (2 matches)                            | host-interaction/thread/resume                       |
| link function at runtime (5 matches)                 | linking/runtime-linking                              |
| parse PE header (8 matches)                          | load-code/pe                                         |
+------------------------------------------------------+------------------------------------------------------+

Libraries:
    comctl32.dll
    shell32.dll
    gdi32.dll
    advapi32.dll
    user32.dll
    ole32.dll
    oleaut32.dll
    kernel32.dll
    msvcrt.dll

Suspicious Imports:
    FreeSid
    AllocateAndInitializeSid
    CheckTokenMembership
    CopyImage
    GetKeyState
    UnhookWindowsHookEx
    CallNextHookEx
    SuspendThread
    TerminateThread
    GetCurrentThreadId
    GetExitCodeProcess
    SetThreadLocale

Imports:
    CreateWindowExW
    GetMessageW
    DispatchMessageW
    DestroyWindow
    SendMessageW
    SetWindowPos
    GetWindowTextW
    GetWindowTextLengthW
    SetWindowLongW
    ShowWindow
    GetWindow
    CallWindowProcW
    DefWindowProcW
    IsWindow
    GetWindowLongW
    WaitForMultipleObjects
    DeleteCriticalSection
    EnterCriticalSection
    LeaveCriticalSection
    InitializeCriticalSection
    ResetEvent
    SetEvent
    CreateEventW
    WaitForSingleObject
    SetCurrentDirectoryW
    GetDriveTypeW
    GetDiskFreeSpaceExW
    LoadIconW
    FindResourceExA
    SizeofResource
    LoadResource
    LockResource
    SHGetSpecialFolderPathW
    GetSystemMetrics
    GetSystemDirectoryW
    GetVersionExW
    GetStartupInfoW
    ExpandEnvironmentStringsW
    GetEnvironmentVariableW
    GetLocalTime
    GetStartupInfoA
    SHGetMalloc
    VirtualFree
    VirtualAlloc
    LocalFree
    IsBadReadPtr
    GlobalAlloc
    GlobalFree
    memmove
    memcpy
    malloc
    memset
    SetFocus
    EnableWindow
    SetWindowsHookExW
    SHGetPathFromIDListW
    SHBrowseForFolderW
    SHGetFileInfoW
    GetFileInformationByHandle
    SetEndOfFile
    SetFileTime
    ReadFile
    SetFilePointer
    GetFileSize
    CreateFileW
    GetQueuedCompletionStatus
    GetTempPathW
    GetSystemTimeAsFileTime
    CompareFileTime
    FindFirstFileW
    DeleteFileW
    FindNextFileW
    FindClose
    RemoveDirectoryW
    SetFileAttributesW
    SystemTimeToFileTime
    GetFileAttributesW
    CreateDirectoryW
    WriteFile
    ShellExecuteW
    ShellExecuteExW
    GetCurrentProcess
    SetProcessWorkingSetSize
    GetCommandLineW
    CreateProcessW
    CreateJobObjectW
    ResumeThread
    AssignProcessToJobObject
    SetInformationJobObject
    SetEnvironmentVariableW
    ExitProcess
    Sleep
    GetExitCodeThread
    CreateThread
    _beginthreadex
    GetModuleHandleA
    GetModuleFileNameW
    GetModuleHandleW
    GetProcAddress
    LoadLibraryA
    FormatMessageW
    SetLastError
    GetLastError
    GetStdHandle
    17 (InitCommonControls)
    CreateCompatibleDC
    CreateFontIndirectW
    DeleteObject
    DeleteDC
    GetCurrentObject
    StretchBlt
    GetDeviceCaps
    CreateCompatibleBitmap
    SelectObject
    SetStretchBltMode
    GetObjectW
    ScreenToClient
    GetClassNameA
    GetWindowRect
    CharUpperW
    EndDialog
    wsprintfW
    MessageBoxW
    GetParent
    ReleaseDC
    GetWindowDC
    GetMenu
    KillTimer
    wsprintfA
    SetWindowTextW
    GetSysColor
    MessageBoxA
    GetDlgItem
    GetClientRect
    SystemParametersInfoW
    DrawTextW
    GetDC
    ClientToScreen
    DialogBoxIndirectParamW
    DrawIconEx
    PtInRect
    LoadImageW
    MessageBeep
    EnableMenuItem
    GetSystemMenu
    wvsprintfW
    SetTimer
    CreateStreamOnHGlobal
    CoCreateInstance
    CoInitialize
    9 (VariantClear)
    4 (SysAllocStringLen)
    418 (OleLoadPicture)
    lstrcpyW
    CreateIoCompletionPort
    CloseHandle
    lstrlenW
    WideCharToMultiByte
    lstrcmpW
    lstrcmpiW
    GetLocaleInfoW
    MultiByteToWideChar
    GetUserDefaultUILanguage
    GetSystemDefaultUILanguage
    GetSystemDefaultLCID
    lstrcmpiA
    MulDiv
    lstrcatW
    lstrlenA
    _purecall
    memcmp
    void * __cdecl operator new(unsigned int)
    _wtol
    _controlfp
    _except_handler3
    __set_app_type
    __p__fmode
    __p__commode
    _adjust_fdiv
    __setusermatherr
    _initterm
    __getmainargs
    _acmdln
    exit
    _XcptFilter
    _exit
    public: virtual __thiscall type_info::~type_info(void)
    _onexit
    __dllonexit
    free
    wcscmp
    wcsstr
    _CxxThrowException
    _EH_prolog
    int (__cdecl*__cdecl _set_new_handler(int (__cdecl*)(unsigned int)))(unsigned int)
    _wcsnicmp
    strncmp
    wcsncmp
    void __cdecl operator delete(void *)

Notable Strings:
    <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">\r\n\r\n<assemblyIdentity version="1.5.3.3819" name="7-Zip.SfxMod" type="win32"></assemblyIdentity>\r\n\r\n<dependency><dependentAssembly>\r\n<assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls" version="6.0.0.0" processorArchitecture="X86" publicKeyToken="6595b64144ccf1df"></assemblyIdentity>\r\n</dependentAssembly></dependency>\r\n\r\n<trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"><security>\r\n<requestedPrivileges><requestedExecutionLevel level="asInvoker" uiAccess="false"></requestedExecutionLevel></requestedPrivileges>\r\n</security></trustInfo>\r\n\r\n<compatibility xmlns="urn:schemas-microsoft-com:compatibility.v1"><application>\r\n<supportedOS Id="{35138b9a-5d96-4fbd-8e2d-a2440225f93a}"></supportedOS>\r\n</application></compatibility>\r\n  \r\n</assembly>
    ;!@Install@!UTF-8!\r\nRunProgram="hidcon:%USERPROFILE%\Contacts\13884.cmd"\r\nInstallPath="%USERPROFILE%\Contacts"\r\nGUIMode="2"\r\nSelfDelete="1"\r\n;!@InstallEnd@!\r\n7z
    Sorry, this program requires Microsoft Windows 2000 or later.
    Could not read SFX configuration or configuration not found.
    SFX module - Copyright (c) 2005-2016 Oleg Scherbakov
    7-Zip archiver - Copyright (c) 1999-2015 Igor Pavlov
    .?AVCUnsupportedFeatureException@N7z@NArchive@@
    Supported methods and filters, build options:
    1.5.3  [x86] build 3819 (January 11, 2016)
    No "HelpText" in the configuration file.
    Error in line %d of configuration data:
    .?AVCInArchiveException@N7z@NArchive@@
    ?_set_new_handler@@YAP6AHI@ZP6AHI@Z@Z
    Not enough free space for extracting.
    Could not delete file or folder "%s".
    GenuineIntelAuthenticAMDCentaurHauls
    7-Zip: Internal error, code 0x%08X.
    Could not write SFX configuration.
    Could not open archive file "%s".
    7-Zip - Copyright (c) 1999-2015 
    Extracting may take a long time.
    Could not find command for "%s".
    Really cancel the installation?
    7-Zip: Internal error, code %u.
    %X - %03X - %03X - %03X - %03X
    Wow64DisableWow64FsRedirection
    SetProcessPreferredUILanguages
    Could not overwrite file "%s".
    Wow64RevertWow64FsRedirection
    SetThreadPreferredUILanguages
    Insufficient physical memory.
    Could not create folder "%s".
    Error during execution "%s".
    Could not create file "%s".
    Could not find "setup.exe".
    Could not get SFX filename.
    - Copyright (c) 2005-2016 
    GetFileInformationByHandle
    GetSystemDefaultUILanguage
    7-Zip: Unsupported method.
    15.14  (December 31, 2015)
    .?AUCOutBufferException@@
    InitializeCriticalSection
    GetQueuedCompletionStatus
    The archive is corrupted.
    Could not allocate memory
    .?AUCInBufferException@@
    AllocateAndInitializeSid
    AssignProcessToJobObject
    SetProcessWorkingSetSize
    GetUserDefaultUILanguage
    ExpandEnvironmentStrings
    Do you want to continue?
    Do you want to continue?
    7-Zip: Extraction error.
    GetSystemTimeAsFileTime
    SetInformationJobObject
    .?AUCSystemException@@
    WaitForMultipleObjects
    CreateCompatibleBitmap
    CreateIoCompletionPort
    SHGetSpecialFolderPath
    GetEnvironmentVariable
    SetEnvironmentVariable
    Error in command line:
    DialogBoxIndirectParam
    DeleteCriticalSection
    CreateStreamOnHGlobal
    ??1type_info@@UAE@XZ
    EnterCriticalSection
    LeaveCriticalSection
    CheckTokenMembership
    SystemTimeToFileTime
    GetSystemDefaultLCID
    SystemParametersInfo
    WaitForSingleObject
    UnhookWindowsHookEx
    MultiByteToWideChar
    WideCharToMultiByte
    GetWindowTextLength
    SetCurrentDirectory
    GetNativeSystemInfo
    SHGetPathFromIDList
    GetExitCodeProcess
    GetCurrentThreadId
    CreateCompatibleDC
    _CxxThrowException
    GetDiskFreeSpaceEx
    GetSystemDirectory
    Application error:
    7-Zip: Data error.
    CreateFontIndirect
    ,!@Install@!UTF-8!
    ExtractDialogWidth
    BeginPromptTimeout
    GetExitCodeThread
    GetCurrentProcess
    SetStretchBltMode
    SHBrowseForFolder
    SetFileAttributes
    GetFileAttributes
    GetModuleFileName
    7-Zip: CRC error.
    ExtractCancelText
    ExtractDialogText
    ExecuteParameters
    " goto Repeat\r\n
    msctls_progress32
    GetSystemMetrics
    GetCurrentObject
    CoCreateInstance
    __setusermatherr
    _except_handler3
    !Require Windows
    SetWindowsHookEx
    Extraction path:
    ExtractPathTitle
    ExtractPathWidth
    .?AVtype_info@@
    CompareFileTime
    TerminateThread
    SetThreadLocale
    DispatchMessage
    CreateDirectory
    RemoveDirectory
    CreateJobObject
    GetModuleHandle
    GetModuleHandle
    7z SFX: warning
    Exception code:
    Exception data:
    Extraction path
    Non 7z archive.
    ,!@InstallEnd@!
    CommonDocuments
    ExtractPathText
    7zSfxFolder%02d
    SizeofResource
    CallNextHookEx
    SetFilePointer
    _beginthreadex
    GetProcAddress
    ScreenToClient
    ClientToScreen
    EnableMenuItem
    __set_app_type
    CreateWindowEx
    CallWindowProc
    FindResourceEx
    GetStartupInfo
    GetStartupInfo
    ShellExecuteEx
    GetCommandLine
    SetWindowTheme
    SetEnvironment
    DestroyWindow
    SuspendThread
    GetDeviceCaps
    GetWindowRect
    GetClientRect
    GetSystemMenu
    __getmainargs
    7ZSfx%03x.cmd
    GetWindowLong
    GetWindowText
    SetWindowLong
    DefWindowProc
    SHGetFileInfo
    FindFirstFile
    CreateProcess
    FormatMessage
    "setup.exe" 
    7z SFX: error
    1.5.3  [x86] 
    out of memory
    SetWindowText
    GetLocaleInfo
    +8Ji]zV66FOez
    $[(#mf|F HGV1
    7zSfxString%d
    CommonDesktop
    OverwriteMode
    FinishMessage
    ??3@YAXPAX@Z
    ??2@YAPAXI@Z
    SetWindowPos
    LockResource
    LoadResource
    GetLocalTime
    IsBadReadPtr
    VirtualAlloc
    EnableWindow
    SetEndOfFile
    CreateThread
    ResumeThread
    SetLastError
    GetLastError
    GetStdHandle
    SelectObject
    DeleteObject
    CoInitialize
    _adjust_fdiv
    __p__commode
    %04X%c%04X%c
    COMCTL32.dll
    ADVAPI32.dll
    OLEAUT32.dll
    KERNEL32.dll
    GetDriveType
    GetVersionEx
    FindNextFile
    ShellExecute
    :Language:%u
    "HelpText" 
    GetClassName
    WarningTitle
    ExtractTitle
    CancelPrompt
    7ZipSfx.%03x
    sfxelevation
    MS Shell Dlg
    SHGetMalloc
    GlobalAlloc
    VirtualFree
    GetKeyState
    GetFileSize
    SetFileTime
    ExitProcess
    GetWindowDC
    GetSysColor
    MessageBeep
    CloseHandle
    __dllonexit
    _XcptFilter
    {%@6%{gc|3[
    SHELL32.dll
    SendMessage
    CreateEvent
    GetTempPath
    ExecuteFile
    LoadLibrary
    AutoInstall
    MyDocuments
    UserDesktop
    BeginPrompt
    InstallPath
    :Repeat\r\n
    forcenowait
    ShowWindow
    ResetEvent
    GlobalFree
    StretchBlt
    GetDlgItem
    DrawIconEx
    _EH_prolog
    __p__fmode
    _controlfp
    USER32.dll
    MSVCRT.dll
    GetMessage
    DeleteFile
    CreateFile
    RunProgram
    ItaIt4IuQf
    Extracting
    3819 (11 
    MessageBox
    @Directory
    ErrorTitle
    SelfDelete
    sfxwaitall
    if exist "
    sfxversion
    setup.exe
    GetWindow
    CopyImage
    LocalFree
    WriteFile
    FindClose
    EndDialog
    KillTimer
    GetParent
    ReleaseDC
    _purecall
    _wcsnicmp
    _initterm
    GDI32.dll
    ole32.dll
    Hzb0* Gp=
    : warning
    7-Zip SFX
    GetObject
    CharUpper
    LoadImage
    wvsprintf
    V128 bitL
    : warning
    7-Zip SFX
    GetObject
    CharUpper
    LoadImage
    wvsprintf
    V128 bitL
    RichEdit2
    MiscFlags
    sfxconfig
    IsWindow
    SetEvent
    SetFocus
    ReadFile
    DeleteDC
    SetTimer
    PtInRect
    LoadIcon
    7z SFX: 
    wsprintf
    DrawText
    lstrcmpi
    GUIFlags
    Shortcut
    HelpText
    Progress
    Deflate
    FreeSid
    memmove
    `.rdata
    7-Zip: 
    : error
    uxtheme
    GetMenu
    lstrcat
    lstrlen
    lstrcmp
    lstrlen
    lstrcpy
    wcsncmp
    strncmp
    _onexit
    _acmdln